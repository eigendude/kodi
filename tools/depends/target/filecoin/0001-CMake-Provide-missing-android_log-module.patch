From fd15b3f88ef732b7eda27b5bc2e751b77a6b5212 Mon Sep 17 00:00:00 2001
From: Garrett Brown <garrett.brown@aclima.io>
Date: Tue, 17 Mar 2020 23:46:27 -0700
Subject: [PATCH] CMake: Provide missing android_log module

The android_log CMake module is provided by the Hunter build system, so we
need to import this file for building without Hunter.
---
 CMakeLists.txt                      |  3 +++
 cmake/modules/Findandroid_log.cmake | 32 +++++++++++++++++++++++++++++
 2 files changed, 35 insertions(+)
 create mode 100644 cmake/modules/Findandroid_log.cmake

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7b3aef0..5f0952a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -25,6 +25,9 @@ HunterGate(
 
 project(cpp_filecoin)
 
+# Expose cmake modules for finding packages
+list(APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake/modules)
+
 if (NOT EXISTS "${CMAKE_TOOLCHAIN_FILE}")
   # https://cgold.readthedocs.io/en/latest/tutorials/toolchain/globals/cxx-standard.html#summary
   set(CMAKE_CXX_STANDARD 17)
diff --git a/cmake/modules/Findandroid_log.cmake b/cmake/modules/Findandroid_log.cmake
new file mode 100644
index 0000000..67158b3
--- /dev/null
+++ b/cmake/modules/Findandroid_log.cmake
@@ -0,0 +1,32 @@
+#.rst:
+# Findandroid_log.cmake
+# ----------
+# Finds the Android log library. Based on a helper function in the Hunter
+# package manager.
+#
+# This will define the following imported target:
+#
+#   android_log::android_log - The Android log library
+#
+
+set(ANDROID_LOG_TARGET_NAME "android_log::android_log")
+
+find_library(ANDROID_LOG_LIBRARY "log")
+find_path(ANDROID_LOG_HEADER_DIR "android/log.h")
+
+if (NOT TARGET ${ANDROID_LOG_TARGET_NAME})
+  message(STATUS "Creating target '${ANDROID_LOG_TARGET_NAME}':")
+  message(STATUS "* library: '${ANDROID_LOG_LIBRARY}'")
+  message(STATUS "* header dir: '${ANDROID_LOG_HEADER_DIR}'")
+
+  add_library(${ANDROID_LOG_TARGET_NAME} UNKNOWN IMPORTED)
+  set_target_properties(
+    ${ANDROID_LOG_TARGET_NAME}
+    PROPERTIES
+    IMPORTED_LINK_INTERFACE_LANGUAGE "CXX"
+    IMPORTED_LOCATION "${ANDROID_LOG_LIBRARY}"
+    INTERFACE_INCLUDE_DIRECTORIES "${ANDROID_LOG_HEADER_DIR}"
+  )
+endif()
+
+mark_as_advanced(ANDROID_LOG_LIBRARY ANDROID_LOG_HEADER_DIR)
-- 
2.20.1

